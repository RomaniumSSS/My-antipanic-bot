# TMA Migration Progress

**–í–µ—Ç–∫–∞**: `feature/tma-migration`
**–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞**: 2025-12-12

---

## –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å

- [ ] –≠—Ç–∞–ø 1: –°—Ä–µ–∑–∞—Ç—å –¥–µ—Ä–µ–≤–æ –¥–æ —è–¥—Ä–∞ (2-3 –¥–Ω—è)
- [ ] –≠—Ç–∞–ø 2: –†–∞–∑–¥–µ–ª–∏—Ç—å —Å–ª–æ–∏ (2-3 –¥–Ω—è)
- [ ] –≠—Ç–∞–ø 3: –î–µ–ø–ª–æ–π –±–æ—Ç–∞ + –ë–î (1-2 –¥–Ω—è)
- [ ] –≠—Ç–∞–ø 4: TMA MVP (3-5 –¥–Ω–µ–π)
- [ ] –≠—Ç–∞–ø 5: –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (1 –¥–µ–Ω—å)

---

## ‚úÖ –≠—Ç–∞–ø 1.1: –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ–∏—á (–ó–ê–í–ï–†–®–ï–ù)

**–î–∞—Ç–∞**: 2025-12-12

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –°–æ–∑–¥–∞–Ω `docs/BACKLOG.md` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
   - –û—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–∏—á (quiz, weekly, health)
   - –£–ª—É—á—à–µ–Ω–∏–π (Claude Sonnet 4.5, –∂–µ—Å—Ç–∫–∏–π —Ç–æ–Ω, –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è, –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞)
   - –ö—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∞–≥–æ–≤ (–∫–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å" —É–¥–∞–ª—è–µ—Ç —Ü–µ–ª—å)

2. ‚úÖ –£–¥–∞–ª–µ–Ω—ã —Ñ–∞–π–ª—ã:
   - `src/bot/handlers/health.py`
   - `src/bot/handlers/weekly.py`
   - `src/bot/handlers/quiz.py`

3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `src/bot/handlers/__init__.py`:
   - –£–±—Ä–∞–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `health_router`, `quiz_router`, `weekly_router`
   - –£–±—Ä–∞–Ω—ã —Ä–æ—É—Ç–µ—Ä—ã –∏–∑ `dp.include_routers()`

4. ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `QuizResult` –∏–∑ `src/database/models.py`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ**:
- `quiz.py` (10KB) + `weekly.py` (5.2KB) + `health.py` (359B) = ~15.5KB –∫–æ–¥–∞
- QuizResult –º–æ–¥–µ–ª—å –≤ –ë–î

**–°—Ç–∞–ª–æ**:
- –¢–æ–ª—å–∫–æ —è–¥—Ä–æ: start, onboarding, morning, steps, stuck, evening
- –ù–µ—Ç QuizResult –º–æ–¥–µ–ª–∏

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –≠—Ç–∞–ø 1.2 - –£–ø—Ä–æ—Å—Ç–∏—Ç—å onboarding (—É–±—Ä–∞—Ç—å AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —ç—Ç–∞–ø–æ–≤)

---

## üîÑ –≠—Ç–∞–ø 1.2: –£–ø—Ä–æ—Å—Ç–∏—Ç—å onboarding (TODO)

**–¶–µ–ª—å**: –£–±—Ä–∞—Ç—å AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —ç—Ç–∞–ø–æ–≤, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ Goal + 1 –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π Stage "–ù–∞—á–∞–ª–æ"

### –ü–ª–∞–Ω:

1. [ ] –ü—Ä–æ—á–∏—Ç–∞—Ç—å `src/bot/handlers/onboarding.py`
2. [ ] –ù–∞–π—Ç–∏ –∫–æ–¥ AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç—Ç–∞–ø–æ–≤
3. [ ] –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ 1 –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ Stage
4. [ ] –£–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (OnboardingSprintStates)
5. [ ] –¢–µ—Å—Ç: —Å–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 1 Stage "–ù–∞—á–∞–ª–æ"
6. [ ] –ö–æ–º–º–∏—Ç

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: `onboarding.py` ~8KB ‚Üí ~3-4KB

---

## üîÑ –≠—Ç–∞–ø 1.3: –£–ø—Ä–æ—Å—Ç–∏—Ç—å morning flow (TODO)

**–¶–µ–ª—å**: –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ AntipanicSession, —É–±—Ä–∞—Ç—å legacy MorningStates

### –ü–ª–∞–Ω:

1. [ ] –ü—Ä–æ—á–∏—Ç–∞—Ç—å `src/bot/handlers/morning.py`
2. [ ] –ù–∞–π—Ç–∏ legacy MorningStates –∫–æ–¥
3. [ ] –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
4. [ ] –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ AntipanicSession (—ç–Ω–µ—Ä–≥–∏—è ‚Üí –º–∏–∫—Ä–æ–¥–µ–π—Å—Ç–≤–∏–µ)
5. [ ] –¢–µ—Å—Ç –≤—Ä—É—á–Ω—É—é: `/morning` ‚Üí –∑–∞–º–µ—Ä —ç–Ω–µ—Ä–≥–∏–∏ ‚Üí –º–∏–∫—Ä–æ–¥–µ–π—Å—Ç–≤–∏–µ
6. [ ] –ö–æ–º–º–∏—Ç

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: `morning.py` ~10KB ‚Üí ~5KB

---

## üîÑ –≠—Ç–∞–ø 1.4: –£–ø—Ä–æ—Å—Ç–∏—Ç—å evening flow (TODO)

**–¶–µ–ª—å**: –ö–æ—Ä–æ—Ç–∫–∏–π –∏—Ç–æ–≥ –¥–Ω—è –±–µ–∑ –¥–ª–∏–Ω–Ω–æ–π —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏

### –ü–ª–∞–Ω:

1. [ ] –ü—Ä–æ—á–∏—Ç–∞—Ç—å `src/bot/handlers/evening.py`
2. [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã (—Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤)
3. [ ] –£–±—Ä–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Ä–µ—Ñ–ª–µ–∫—Å–∏—é
4. [ ] –û—Å—Ç–∞–≤–∏—Ç—å: –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ ‚Üí +XP ‚Üí streak
5. [ ] –¢–µ—Å—Ç –≤—Ä—É—á–Ω—É—é: `/evening` ‚Üí –ø–æ–∫–∞–∑ —à–∞–≥–æ–≤ ‚Üí –æ—Ç–º–µ—Ç–∫–∞ ‚Üí +XP
6. [ ] –ö–æ–º–º–∏—Ç

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: `evening.py` ~7KB ‚Üí ~3KB

---

## üîÑ –≠—Ç–∞–ø 1.5: –ß–∏—Å—Ç–∫–∞ states.py (TODO)

**–¶–µ–ª—å**: –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –ü–ª–∞–Ω:

1. [ ] –ü—Ä–æ—á–∏—Ç–∞—Ç—å `src/bot/states.py`
2. [ ] –£–¥–∞–ª–∏—Ç—å `QuizStates` (–µ—Å–ª–∏ –µ—Å—Ç—å)
3. [ ] –£–¥–∞–ª–∏—Ç—å `OnboardingSprintStates` (paywall)
4. [ ] –£–¥–∞–ª–∏—Ç—å legacy `MorningStates` (–µ—Å–ª–∏ –µ—Å—Ç—å)
5. [ ] –û—Å—Ç–∞–≤–∏—Ç—å: `OnboardingStates`, `AntipanicSession`, `StuckStates`, `EveningStates`
6. [ ] –ö–æ–º–º–∏—Ç

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

**–†–∞–∑–º–µ—Ä –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã handlers/**:

| –î–æ              | –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1.1 | –¶–µ–ª—å –ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1 |
|-----------------|------------------|---------------------|
| ~70KB           | ~54.5KB          | ~40KB              |

**–ú–æ–¥–µ–ª–∏ –ë–î**:

| –î–æ              | –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1.1 | –¶–µ–ª—å –ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1 |
|-----------------|------------------|---------------------|
| User, Goal, Stage, Step, DailyLog, QuizResult | User, Goal, Stage, Step, DailyLog | –¢–æ –∂–µ (QuizResult —É–¥–∞–ª–µ–Ω) |

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –±–∞–≥–∏ (—á–∏–Ω–∏—Ç—å –ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1)

1. **–ö–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å" —É–¥–∞–ª—è–µ—Ç —Ü–µ–ª—å** (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - –î–æ–ª–∂–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∞–ø—ã, –∞ –Ω–µ —É–¥–∞–ª—è—Ç—å —Ü–µ–ª—å
   - –ù—É–∂–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/edit_goal` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
   - –ù—É–∂–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å" —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø–æ—Å–ª–µ TMA MVP)

–°–º. `docs/BACKLOG.md`:
- –ó–∞–º–µ–Ω–∞ OpenAI ‚Üí Claude Sonnet 4.5
- –ñ–µ—Å—Ç–∫–∏–π —Ç–æ–Ω (–ø—É—à –∫ –¥–µ–π—Å—Ç–≤–∏—é)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –º–∏–∫—Ä–æ–¥–µ–π—Å—Ç–≤–∏–π
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–æ–π
- –£—Å–∏–ª–µ–Ω–Ω–∞—è –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-12-12, –≠—Ç–∞–ø 1.1 –∑–∞–≤–µ—Ä—à–µ–Ω
