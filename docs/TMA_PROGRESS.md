# TMA Migration Progress

**–í–µ—Ç–∫–∞**: `feature/tma-migration`
**–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞**: 2025-12-12

---

## –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å

- [x] –≠—Ç–∞–ø 1.1: –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ–∏—á ‚úÖ
- [x] –≠—Ç–∞–ø 1.2: –£–ø—Ä–æ—Å—Ç–∏—Ç—å onboarding ‚úÖ
- [x] –≠—Ç–∞–ø 1.3: –£–ø—Ä–æ—Å—Ç–∏—Ç—å morning flow ‚úÖ
- [ ] –≠—Ç–∞–ø 1.4: –£–ø—Ä–æ—Å—Ç–∏—Ç—å evening flow
- [ ] –≠—Ç–∞–ø 1.5: –ß–∏—Å—Ç–∫–∞ states.py (—á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ)
- [ ] –≠—Ç–∞–ø 2: –†–∞–∑–¥–µ–ª–∏—Ç—å —Å–ª–æ–∏ (2-3 –¥–Ω—è)
- [ ] –≠—Ç–∞–ø 3: –î–µ–ø–ª–æ–π –±–æ—Ç–∞ + –ë–î (1-2 –¥–Ω—è)
- [ ] –≠—Ç–∞–ø 4: TMA MVP (3-5 –¥–Ω–µ–π)
- [ ] –≠—Ç–∞–ø 5: –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (1 –¥–µ–Ω—å)

---

## ‚úÖ –≠—Ç–∞–ø 1.1: –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ–∏—á (–ó–ê–í–ï–†–®–ï–ù)

**–î–∞—Ç–∞**: 2025-12-12

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –°–æ–∑–¥–∞–Ω `docs/BACKLOG.md` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
   - –û—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–∏—á (quiz, weekly, health)
   - –£–ª—É—á—à–µ–Ω–∏–π (Claude Sonnet 4.5, –∂–µ—Å—Ç–∫–∏–π —Ç–æ–Ω, –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è, –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞)
   - –ö—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∞–≥–æ–≤ (–∫–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å" —É–¥–∞–ª—è–µ—Ç —Ü–µ–ª—å)

2. ‚úÖ –£–¥–∞–ª–µ–Ω—ã —Ñ–∞–π–ª—ã:
   - `src/bot/handlers/health.py`
   - `src/bot/handlers/weekly.py`
   - `src/bot/handlers/quiz.py`

3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `src/bot/handlers/__init__.py`:
   - –£–±—Ä–∞–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `health_router`, `quiz_router`, `weekly_router`
   - –£–±—Ä–∞–Ω—ã —Ä–æ—É—Ç–µ—Ä—ã –∏–∑ `dp.include_routers()`

4. ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `QuizResult` –∏–∑ `src/database/models.py`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ**:
- `quiz.py` (10KB) + `weekly.py` (5.2KB) + `health.py` (359B) = ~15.5KB –∫–æ–¥–∞
- QuizResult –º–æ–¥–µ–ª—å –≤ –ë–î

**–°—Ç–∞–ª–æ**:
- –¢–æ–ª—å–∫–æ —è–¥—Ä–æ: start, onboarding, morning, steps, stuck, evening
- –ù–µ—Ç QuizResult –º–æ–¥–µ–ª–∏

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –≠—Ç–∞–ø 1.2 - –£–ø—Ä–æ—Å—Ç–∏—Ç—å onboarding (—É–±—Ä–∞—Ç—å AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —ç—Ç–∞–ø–æ–≤)

---

## ‚úÖ –≠—Ç–∞–ø 1.2: –£–ø—Ä–æ—Å—Ç–∏—Ç—å onboarding (–ó–ê–í–ï–†–®–ï–ù)

**–î–∞—Ç–∞**: 2025-12-12

**–¶–µ–ª—å**: –£–±—Ä–∞—Ç—å AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —ç—Ç–∞–ø–æ–≤, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ Goal + 1 –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π Stage "–ù–∞—á–∞–ª–æ"

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –£–ø—Ä–æ—â–µ–Ω `src/bot/handlers/onboarding.py`:
   - –£–±—Ä–∞–Ω –∏–º–ø–æ—Ä—Ç `ai_service` –∏ `ConfirmCallback`
   - –£–¥–∞–ª–µ–Ω –≤—ã–∑–æ–≤ `ai_service.decompose_goal()`
   - –£–±—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ `confirming_stages`)
   - –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ—Ç—Å—è Goal + 1 Stage "–ù–∞—á–∞–ª–æ" —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –¥–µ–¥–ª–∞–π–Ω–∞
   - –î–æ–±–∞–≤–ª–µ–Ω—ã AICODE-NOTE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `src/bot/states.py`:
   - –£–¥–∞–ª–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `OnboardingStates.confirming_stages`
   - –î–æ–±–∞–≤–ª–µ–Ω AICODE-NOTE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

3. ‚úÖ –£–ø—Ä–æ—â–µ–Ω `src/bot/handlers/start.py`:
   - –£–±—Ä–∞–Ω –∏–º–ø–æ—Ä—Ç `quiz.py` –∏ `QuizResult` –º–æ–¥–µ–ª–∏
   - –£–±—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–≤–∏–∑-–∏—Å—Ç–æ—Ä–∏–∏
   - –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Ü–µ–ª–∏ (–±–µ–∑ –∫–≤–∏–∑–∞)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã AICODE-NOTE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤: —É—Å–ø–µ—à–Ω–æ

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ**:
- `onboarding.py`: 236 —Å—Ç—Ä–æ–∫ —Å AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —ç—Ç–∞–ø–æ–≤ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
- `start.py`: –ª–æ–≥–∏–∫–∞ —Å –∫–≤–∏–∑–æ–º –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π QuizResult
- –°–æ—Å—Ç–æ—è–Ω–∏–µ `OnboardingStates.confirming_stages`

**–°—Ç–∞–ª–æ**:
- `onboarding.py`: 165 —Å—Ç—Ä–æ–∫, –ø—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ Goal + Stage "–ù–∞—á–∞–ª–æ"
- `start.py`: —É–ø—Ä–æ—â–µ–Ω, –ø—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ onboarding
- –£–±—Ä–∞–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `confirming_stages`
- –í—Å–µ —Ñ–∞–π–ª—ã —Å AICODE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –¥–ª—è –±—É–¥—É—â–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –≠—Ç–∞–ø 1.3 - –£–ø—Ä–æ—Å—Ç–∏—Ç—å morning flow

---

## ‚úÖ –≠—Ç–∞–ø 1.3: –£–ø—Ä–æ—Å—Ç–∏—Ç—å morning flow (–ó–ê–í–ï–†–®–ï–ù)

**–î–∞—Ç–∞**: 2025-12-12

**–¶–µ–ª—å**: –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ AntipanicSession, —É–±—Ä–∞—Ç—å legacy MorningStates

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω `src/bot/handlers/morning.py`:
   - –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ AntipanicSession
   - –ù–µ—Ç legacy MorningStates –∫–æ–¥–∞
   - –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

2. ‚úÖ –£–ø—Ä–æ—â–µ–Ω `src/bot/states.py`:
   - –£–¥–∞–ª—ë–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π `QuizStates` (–∫–≤–∏–∑ —É–¥–∞–ª—ë–Ω –≤ –≠—Ç–∞–ø–µ 1.1)
   - –£–¥–∞–ª—ë–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π `GoalStates` (–¥—É–±–ª–∏–∫–∞—Ç OnboardingStates)
   - –û—Å—Ç–∞–≤–ª–µ–Ω `OnboardingSprintStates` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ steps.py –¥–ª—è –ø–µ–π–≤–æ–ª–ª–∞)
   - –î–æ–±–∞–≤–ª–µ–Ω AICODE-NOTE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤: —É—Å–ø–µ—à–Ω–æ

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ** (states.py):
- 7 StatesGroup –∫–ª–∞—Å—Å–æ–≤ (73 —Å—Ç—Ä–æ–∫–∏)
- QuizStates (–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π)
- GoalStates (–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π)

**–°—Ç–∞–ª–æ** (states.py):
- 5 StatesGroup –∫–ª–∞—Å—Å–æ–≤ (61 —Å—Ç—Ä–æ–∫–∞)
- –¢–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ states
- AICODE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**morning.py**:
- –ù–µ –∏–∑–º–µ–Ω—è–ª—Å—è (—É–∂–µ —É–ø—Ä–æ—â—ë–Ω)
- 283 —Å—Ç—Ä–æ–∫–∏ —Å —á–∏—Å—Ç—ã–º AntipanicSession —Ñ–ª–æ—É

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –≠—Ç–∞–ø 1.4 - –£–ø—Ä–æ—Å—Ç–∏—Ç—å evening flow

---

## üîÑ –≠—Ç–∞–ø 1.4: –£–ø—Ä–æ—Å—Ç–∏—Ç—å evening flow (TODO)

**–¶–µ–ª—å**: –ö–æ—Ä–æ—Ç–∫–∏–π –∏—Ç–æ–≥ –¥–Ω—è –±–µ–∑ –¥–ª–∏–Ω–Ω–æ–π —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏

### –ü–ª–∞–Ω:

1. [ ] –ü—Ä–æ—á–∏—Ç–∞—Ç—å `src/bot/handlers/evening.py`
2. [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã (—Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤)
3. [ ] –£–±—Ä–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Ä–µ—Ñ–ª–µ–∫—Å–∏—é
4. [ ] –û—Å—Ç–∞–≤–∏—Ç—å: –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ ‚Üí +XP ‚Üí streak
5. [ ] –¢–µ—Å—Ç –≤—Ä—É—á–Ω—É—é: `/evening` ‚Üí –ø–æ–∫–∞–∑ —à–∞–≥–æ–≤ ‚Üí –æ—Ç–º–µ—Ç–∫–∞ ‚Üí +XP
6. [ ] –ö–æ–º–º–∏—Ç

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: `evening.py` ~7KB ‚Üí ~3KB

---

## ‚úÖ –≠—Ç–∞–ø 1.5: –ß–∏—Å—Ç–∫–∞ states.py (–ß–ê–°–¢–ò–ß–ù–û –ó–ê–í–ï–†–®–ï–ù–û)

**–î–∞—Ç–∞**: 2025-12-12 (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–æ —Å –≠—Ç–∞–ø–æ–º 1.3)

**–¶–µ–ª—å**: –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –£–¥–∞–ª—ë–Ω `QuizStates` (–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π)
2. ‚úÖ –£–¥–∞–ª—ë–Ω `GoalStates` (–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π)
3. ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω `OnboardingSprintStates` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ steps.py –¥–ª—è –ø–µ–π–≤–æ–ª–ª–∞)

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ**: 7 StatesGroup –∫–ª–∞—Å—Å–æ–≤
**–°—Ç–∞–ª–æ**: 5 StatesGroup –∫–ª–∞—Å—Å–æ–≤

**–û—Å—Ç–∞–≤—à–∏–µ—Å—è states**:
- ‚úÖ `OnboardingStates` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π —Ü–µ–ª–∏
- ‚úÖ `AntipanicSession` - —É—Ç—Ä–µ–Ω–Ω–∏–π —Ñ–ª–æ—É
- ‚úÖ `StuckStates` - –ø–æ–º–æ—â—å –ø—Ä–∏ —Å—Ç—É–ø–æ—Ä–µ
- ‚úÖ `EveningStates` - –≤–µ—á–µ—Ä–Ω–∏–π –æ—Ç—á—ë—Ç
- ‚úÖ `OnboardingSprintStates` - –º–∏–Ω–∏-—Å–ø—Ä–∏–Ω—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ steps.py)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–∞–ø –æ–±—ä–µ–¥–∏–Ω—ë–Ω —Å 1.3, —Ç–∞–∫ –∫–∞–∫ —á–∏—Å—Ç–∫–∞ states.py –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–∞ —Å —É–ø—Ä–æ—â–µ–Ω–∏–µ–º morning flow.

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

**–†–∞–∑–º–µ—Ä –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã handlers/**:

| –î–æ              | –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1.1 | –¶–µ–ª—å –ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1 |
|-----------------|------------------|---------------------|
| ~70KB           | ~54.5KB          | ~40KB              |

**–ú–æ–¥–µ–ª–∏ –ë–î**:

| –î–æ              | –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1.1 | –¶–µ–ª—å –ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1 |
|-----------------|------------------|---------------------|
| User, Goal, Stage, Step, DailyLog, QuizResult | User, Goal, Stage, Step, DailyLog | –¢–æ –∂–µ (QuizResult —É–¥–∞–ª–µ–Ω) |

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –±–∞–≥–∏ (—á–∏–Ω–∏—Ç—å –ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1)

1. **–ö–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å" —É–¥–∞–ª—è–µ—Ç —Ü–µ–ª—å** (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - –î–æ–ª–∂–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∞–ø—ã, –∞ –Ω–µ —É–¥–∞–ª—è—Ç—å —Ü–µ–ª—å
   - –ù—É–∂–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/edit_goal` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
   - –ù—É–∂–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å" —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø–æ—Å–ª–µ TMA MVP)

–°–º. `docs/BACKLOG.md`:
- –ó–∞–º–µ–Ω–∞ OpenAI ‚Üí Claude Sonnet 4.5
- –ñ–µ—Å—Ç–∫–∏–π —Ç–æ–Ω (–ø—É—à –∫ –¥–µ–π—Å—Ç–≤–∏—é)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –º–∏–∫—Ä–æ–¥–µ–π—Å—Ç–≤–∏–π
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–æ–π
- –£—Å–∏–ª–µ–Ω–Ω–∞—è –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-12-12, –≠—Ç–∞–ø—ã 1.1-1.3 –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –≠—Ç–∞–ø 1.5 —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω
