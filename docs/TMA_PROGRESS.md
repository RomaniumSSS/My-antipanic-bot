# TMA Migration Progress

**–í–µ—Ç–∫–∞**: `feature/tma-migration`
**–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞**: 2025-12-12

---

## –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å

- [x] –≠—Ç–∞–ø 1.1: –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ–∏—á ‚úÖ
- [x] –≠—Ç–∞–ø 1.2: –£–ø—Ä–æ—Å—Ç–∏—Ç—å onboarding ‚úÖ
- [x] –≠—Ç–∞–ø 1.3: –£–ø—Ä–æ—Å—Ç–∏—Ç—å morning flow ‚úÖ
- [x] –≠—Ç–∞–ø 1.4: –£–ø—Ä–æ—Å—Ç–∏—Ç—å evening flow ‚úÖ
- [x] –≠—Ç–∞–ø 1.5: –ß–∏—Å—Ç–∫–∞ states.py ‚úÖ
- [ ] –≠—Ç–∞–ø 2: –†–∞–∑–¥–µ–ª–∏—Ç—å —Å–ª–æ–∏ (–ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º, 3-5 –¥–Ω–µ–π) üîÑ
  - [x] 2.1: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ/–ø—Ä–æ–ø—É—Å–∫ —à–∞–≥–∞ (Complete/Skip Step Use-Case) ‚úÖ
  - [x] 2.2: –£—Ç—Ä–µ–Ω–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π (Morning Assignment Use-Case) ‚úÖ
  - [ ] 2.3: Stuck-–ª–æ–≥–∏–∫–∞ + –≤–∞—Ä–∏–∞–Ω—Ç—ã (Stuck Resolution Use-Case)
  - [ ] 2.4: –í–µ—á–µ—Ä–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π (Evening Reflection Use-Case)
  - [ ] 2.5: –ó–∞–∫—Ä—ã—Ç—å –±–∞–≥ —Å "–ò–∑–º–µ–Ω–∏—Ç—å"
  - [ ] 2.6: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- [ ] –≠—Ç–∞–ø 3: –î–µ–ø–ª–æ–π –±–æ—Ç–∞ + –ë–î (1-2 –¥–Ω—è)
- [ ] –≠—Ç–∞–ø 4: TMA MVP (3-5 –¥–Ω–µ–π)
- [ ] –≠—Ç–∞–ø 5: –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (1 –¥–µ–Ω—å)

---

## ‚úÖ –≠—Ç–∞–ø 1.1: –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ–∏—á (–ó–ê–í–ï–†–®–ï–ù)

**–î–∞—Ç–∞**: 2025-12-12

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –°–æ–∑–¥–∞–Ω `docs/BACKLOG.md` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
   - –û—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–∏—á (quiz, weekly, health)
   - –£–ª—É—á—à–µ–Ω–∏–π (Claude Sonnet 4.5, –∂–µ—Å—Ç–∫–∏–π —Ç–æ–Ω, –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è, –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞)
   - –ö—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∞–≥–æ–≤ (–∫–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å" —É–¥–∞–ª—è–µ—Ç —Ü–µ–ª—å)

2. ‚úÖ –£–¥–∞–ª–µ–Ω—ã —Ñ–∞–π–ª—ã:
   - `src/bot/handlers/health.py`
   - `src/bot/handlers/weekly.py`
   - `src/bot/handlers/quiz.py`

3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `src/bot/handlers/__init__.py`:
   - –£–±—Ä–∞–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `health_router`, `quiz_router`, `weekly_router`
   - –£–±—Ä–∞–Ω—ã —Ä–æ—É—Ç–µ—Ä—ã –∏–∑ `dp.include_routers()`

4. ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `QuizResult` –∏–∑ `src/database/models.py`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ**:
- `quiz.py` (10KB) + `weekly.py` (5.2KB) + `health.py` (359B) = ~15.5KB –∫–æ–¥–∞
- QuizResult –º–æ–¥–µ–ª—å –≤ –ë–î

**–°—Ç–∞–ª–æ**:
- –¢–æ–ª—å–∫–æ —è–¥—Ä–æ: start, onboarding, morning, steps, stuck, evening
- –ù–µ—Ç QuizResult –º–æ–¥–µ–ª–∏

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –≠—Ç–∞–ø 1.2 - –£–ø—Ä–æ—Å—Ç–∏—Ç—å onboarding (—É–±—Ä–∞—Ç—å AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —ç—Ç–∞–ø–æ–≤)

---

## ‚úÖ –≠—Ç–∞–ø 1.2: –£–ø—Ä–æ—Å—Ç–∏—Ç—å onboarding (–ó–ê–í–ï–†–®–ï–ù)

**–î–∞—Ç–∞**: 2025-12-12

**–¶–µ–ª—å**: –£–±—Ä–∞—Ç—å AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —ç—Ç–∞–ø–æ–≤, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ Goal + 1 –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π Stage "–ù–∞—á–∞–ª–æ"

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –£–ø—Ä–æ—â–µ–Ω `src/bot/handlers/onboarding.py`:
   - –£–±—Ä–∞–Ω –∏–º–ø–æ—Ä—Ç `ai_service` –∏ `ConfirmCallback`
   - –£–¥–∞–ª–µ–Ω –≤—ã–∑–æ–≤ `ai_service.decompose_goal()`
   - –£–±—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ `confirming_stages`)
   - –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ—Ç—Å—è Goal + 1 Stage "–ù–∞—á–∞–ª–æ" —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –¥–µ–¥–ª–∞–π–Ω–∞
   - –î–æ–±–∞–≤–ª–µ–Ω—ã AICODE-NOTE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `src/bot/states.py`:
   - –£–¥–∞–ª–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `OnboardingStates.confirming_stages`
   - –î–æ–±–∞–≤–ª–µ–Ω AICODE-NOTE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

3. ‚úÖ –£–ø—Ä–æ—â–µ–Ω `src/bot/handlers/start.py`:
   - –£–±—Ä–∞–Ω –∏–º–ø–æ—Ä—Ç `quiz.py` –∏ `QuizResult` –º–æ–¥–µ–ª–∏
   - –£–±—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–≤–∏–∑-–∏—Å—Ç–æ—Ä–∏–∏
   - –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Ü–µ–ª–∏ (–±–µ–∑ –∫–≤–∏–∑–∞)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã AICODE-NOTE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤: —É—Å–ø–µ—à–Ω–æ

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ**:
- `onboarding.py`: 236 —Å—Ç—Ä–æ–∫ —Å AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —ç—Ç–∞–ø–æ–≤ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
- `start.py`: –ª–æ–≥–∏–∫–∞ —Å –∫–≤–∏–∑–æ–º –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π QuizResult
- –°–æ—Å—Ç–æ—è–Ω–∏–µ `OnboardingStates.confirming_stages`

**–°—Ç–∞–ª–æ**:
- `onboarding.py`: 165 —Å—Ç—Ä–æ–∫, –ø—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ Goal + Stage "–ù–∞—á–∞–ª–æ"
- `start.py`: —É–ø—Ä–æ—â–µ–Ω, –ø—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ onboarding
- –£–±—Ä–∞–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `confirming_stages`
- –í—Å–µ —Ñ–∞–π–ª—ã —Å AICODE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –¥–ª—è –±—É–¥—É—â–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –≠—Ç–∞–ø 1.3 - –£–ø—Ä–æ—Å—Ç–∏—Ç—å morning flow

---

## ‚úÖ –≠—Ç–∞–ø 1.3: –£–ø—Ä–æ—Å—Ç–∏—Ç—å morning flow (–ó–ê–í–ï–†–®–ï–ù)

**–î–∞—Ç–∞**: 2025-12-12

**–¶–µ–ª—å**: –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ AntipanicSession, —É–±—Ä–∞—Ç—å legacy MorningStates

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω `src/bot/handlers/morning.py`:
   - –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ AntipanicSession
   - –ù–µ—Ç legacy MorningStates –∫–æ–¥–∞
   - –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

2. ‚úÖ –£–ø—Ä–æ—â–µ–Ω `src/bot/states.py`:
   - –£–¥–∞–ª—ë–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π `QuizStates` (–∫–≤–∏–∑ —É–¥–∞–ª—ë–Ω –≤ –≠—Ç–∞–ø–µ 1.1)
   - –£–¥–∞–ª—ë–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π `GoalStates` (–¥—É–±–ª–∏–∫–∞—Ç OnboardingStates)
   - –û—Å—Ç–∞–≤–ª–µ–Ω `OnboardingSprintStates` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ steps.py –¥–ª—è –ø–µ–π–≤–æ–ª–ª–∞)
   - –î–æ–±–∞–≤–ª–µ–Ω AICODE-NOTE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤: —É—Å–ø–µ—à–Ω–æ

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ** (states.py):
- 7 StatesGroup –∫–ª–∞—Å—Å–æ–≤ (73 —Å—Ç—Ä–æ–∫–∏)
- QuizStates (–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π)
- GoalStates (–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π)

**–°—Ç–∞–ª–æ** (states.py):
- 5 StatesGroup –∫–ª–∞—Å—Å–æ–≤ (61 —Å—Ç—Ä–æ–∫–∞)
- –¢–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ states
- AICODE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**morning.py**:
- –ù–µ –∏–∑–º–µ–Ω—è–ª—Å—è (—É–∂–µ —É–ø—Ä–æ—â—ë–Ω)
- 283 —Å—Ç—Ä–æ–∫–∏ —Å —á–∏—Å—Ç—ã–º AntipanicSession —Ñ–ª–æ—É

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –≠—Ç–∞–ø 1.4 - –£–ø—Ä–æ—Å—Ç–∏—Ç—å evening flow

---

## ‚úÖ –≠—Ç–∞–ø 1.4: –£–ø—Ä–æ—Å—Ç–∏—Ç—å evening flow (–ó–ê–í–ï–†–®–ï–ù)

**–î–∞—Ç–∞**: 2025-12-12

**–¶–µ–ª—å**: –ö–æ—Ä–æ—Ç–∫–∏–π –∏—Ç–æ–≥ –¥–Ω—è –±–µ–∑ –¥–ª–∏–Ω–Ω–æ–π —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –£–ø—Ä–æ—â–µ–Ω `src/bot/handlers/evening.py`:
   - –£–±—Ä–∞–Ω –∏–º–ø–æ—Ä—Ç `RatingCallback` –∏ `rating_keyboard`
   - –£–¥–∞–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `show_rating_prompt()` ‚Üí –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ `finish_day()`
   - –£–¥–∞–ª–µ–Ω callback handler `process_rating()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ü–µ–Ω–æ–∫ 1-5
   - –£–±—Ä–∞–Ω—ã –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Ü–µ–Ω–∫–∏
   - –£–±—Ä–∞–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `day_rating` –≤ `DailyLog`
   - –û—Å—Ç–∞–≤–ª–µ–Ω –ø–æ–∫–∞–∑ —à–∞–≥–æ–≤ —Å –æ—Ç–º–µ—Ç–∫–∞–º–∏ ‚úÖ/‚è≠/‚¨ú
   - –û—Å—Ç–∞–≤–ª–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ streak –∏ XP
   - –î–æ–±–∞–≤–ª–µ–Ω—ã AICODE-NOTE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `src/bot/states.py`:
   - –£–¥–∞–ª–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `EveningStates.rating_day`
   - –î–æ–±–∞–≤–ª–µ–Ω AICODE-NOTE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤: —É—Å–ø–µ—à–Ω–æ

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ** (evening.py):
- 219 —Å—Ç—Ä–æ–∫ —Å –æ—Ü–µ–Ω–∫–æ–π –¥–Ω—è (1-5) –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- –°–æ—Å—Ç–æ—è–Ω–∏–µ `EveningStates.rating_day`
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `day_rating` –≤ DailyLog

**–°—Ç–∞–ª–æ** (evening.py):
- 190 —Å—Ç—Ä–æ–∫ (~13% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ)
- –ü—Ä—è–º–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–Ω—è –±–µ–∑ –æ—Ü–µ–Ω–∫–∏
- –§–æ–∫—É—Å –Ω–∞ –≥–ª–∞–≤–Ω–æ–º: —à–∞–≥–∏ ‚Üí XP ‚Üí streak
- AICODE –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**states.py**:
- –£–±—Ä–∞–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `rating_day` –∏–∑ `EveningStates`
- –î–æ–±–∞–≤–ª–µ–Ω AICODE-NOTE —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º

### ‚ö†Ô∏è Trade-offs:

**–ü–æ—Ç–µ—Ä–∏:**
- –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ–π –æ—Ü–µ–Ω–∫–µ –¥–Ω—è (–ø–æ–ª–µ `day_rating` –æ—Å—Ç–∞—ë—Ç—Å—è –ø—É—Å—Ç—ã–º)
- –ù–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ú–µ–Ω–µ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ (–±–µ–∑ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)

**–í—ã–∏–≥—Ä—ã—à:**
- –ë—ã—Å—Ç—Ä–µ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–Ω—è (–º–µ–Ω—å—à–µ –∫–ª–∏–∫–æ–≤)
- –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π –∫–æ–¥ (–º–µ–Ω—å—à–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM)
- –§–æ–∫—É—Å –Ω–∞ –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫–∞—Ö (–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏, streak)

**–í–æ–∑–º–æ–∂–Ω–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å–ª–µ TMA MVP:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ streak (–±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ü–µ–Ω–∫–∏)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ % –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –≠—Ç–∞–ø 2 - –†–∞–∑–¥–µ–ª–∏—Ç—å —Å–ª–æ–∏ (handlers ‚Üí services ‚Üí domain)

---

## ‚úÖ –≠—Ç–∞–ø 1.5: –ß–∏—Å—Ç–∫–∞ states.py (–ó–ê–í–ï–†–®–ï–ù)

**–î–∞—Ç–∞**: 2025-12-12 (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–æ —Å –≠—Ç–∞–ø–∞–º–∏ 1.3 –∏ 1.4)

**–¶–µ–ª—å**: –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

**–≠—Ç–∞–ø 1.3:**
1. ‚úÖ –£–¥–∞–ª—ë–Ω `QuizStates` (–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π, –∫–≤–∏–∑ —É–¥–∞–ª—ë–Ω –≤ –≠—Ç–∞–ø–µ 1.1)
2. ‚úÖ –£–¥–∞–ª—ë–Ω `GoalStates` (–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π, –¥—É–±–ª–∏–∫–∞—Ç OnboardingStates)
3. ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω `OnboardingSprintStates` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ steps.py –¥–ª—è –ø–µ–π–≤–æ–ª–ª–∞)

**–≠—Ç–∞–ø 1.4:**
4. ‚úÖ –£–¥–∞–ª–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `EveningStates.rating_day` (–æ—Ü–µ–Ω–∫–∞ –¥–Ω—è —É–±—Ä–∞–Ω–∞)

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ** (–ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1.2): 7 StatesGroup –∫–ª–∞—Å—Å–æ–≤, 73 —Å—Ç—Ä–æ–∫–∏
**–°—Ç–∞–ª–æ** (–ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1.4): 5 StatesGroup –∫–ª–∞—Å—Å–æ–≤, 59 —Å—Ç—Ä–æ–∫

**–û—Å—Ç–∞–≤—à–∏–µ—Å—è states** (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –¥–ª—è MVP):
- ‚úÖ `OnboardingStates` (2 —Å–æ—Å—Ç–æ—è–Ω–∏—è) - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π —Ü–µ–ª–∏
- ‚úÖ `AntipanicSession` (5 —Å–æ—Å—Ç–æ—è–Ω–∏–π) - —É—Ç—Ä–µ–Ω–Ω–∏–π —Ñ–ª–æ—É
- ‚úÖ `StuckStates` (4 —Å–æ—Å—Ç–æ—è–Ω–∏—è) - –ø–æ–º–æ—â—å –ø—Ä–∏ —Å—Ç—É–ø–æ—Ä–µ
- ‚úÖ `EveningStates` (2 —Å–æ—Å—Ç–æ—è–Ω–∏—è) - –≤–µ—á–µ—Ä–Ω–∏–π –æ—Ç—á—ë—Ç (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π)
- ‚úÖ `OnboardingSprintStates` (1 —Å–æ—Å—Ç–æ—è–Ω–∏–µ) - –º–∏–Ω–∏-—Å–ø—Ä–∏–Ω—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ steps.py)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à—ë–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é, –≤—Å–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã.

---

## üîÑ –≠—Ç–∞–ø 2: –†–∞–∑–¥–µ–ª–∏—Ç—å —Å–ª–æ–∏ (–í –†–ê–ë–û–¢–ï)

**–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞**: 2025-12-12

**–¶–µ–ª—å**: –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–¥ –¥–ª—è TMA, —Ä–∞–∑–¥–µ–ª–∏–≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –≥–¥–µ –≠—Ç–∞–ø 3/4 —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–º–∏.

**–ü–æ–¥—Ö–æ–¥**: –ù–ï "–ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å—ë", –∞ –ø–æ –æ–¥–Ω–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞ —Ä–∞–∑. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ sub-stage: —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä—É–∫–∞–º–∏ + –∫–æ–º–º–∏—Ç.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏ (–∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞):

```
src/
‚îú‚îÄ‚îÄ core/              # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–±–µ–∑ aiogram/fastapi)
‚îÇ   ‚îú‚îÄ‚îÄ domain/        # –ß–∏—Å—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (–±–µ–∑ –ë–î, –±–µ–∑ Telegram)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gamification.py  # calculate_xp, update_streak ‚úÖ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ step_rules.py    # can_complete_step, can_skip_step ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stuck_rules.py   # is_stuck, generate_microhit_options
‚îÇ   ‚îî‚îÄ‚îÄ use_cases/     # –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ complete_step.py  # ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ skip_step.py      # ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ assign_morning_steps.py
‚îÇ       ‚îú‚îÄ‚îÄ resolve_stuck.py
‚îÇ       ‚îî‚îÄ‚îÄ complete_daily_reflection.py
‚îú‚îÄ‚îÄ storage/           # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (—Ç—É–ø—ã–µ CRUD)
‚îÇ   ‚îú‚îÄ‚îÄ user_repo.py    # ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ goal_repo.py
‚îÇ   ‚îú‚îÄ‚îÄ step_repo.py    # ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ stage_repo.py   # ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ daily_log_repo.py  # ‚úÖ
‚îî‚îÄ‚îÄ bot/               # aiogram handlers (thin layer)
    ‚îú‚îÄ‚îÄ handlers/
    ‚îÇ   ‚îî‚îÄ‚îÄ steps.py    # ‚úÖ (thin handler)
    ‚îú‚îÄ‚îÄ keyboards.py
    ‚îî‚îÄ‚îÄ states.py
```

### Sub-stages:

---

#### ‚úÖ 2.1: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ/–ø—Ä–æ–ø—É—Å–∫ —à–∞–≥–∞ (Complete/Skip Step Use-Case)

**–°—Ç–∞—Ç—É—Å**: –ó–∞–≤–µ—Ä—à–µ–Ω
**–î–∞—Ç–∞**: 2025-12-12
**–ö–æ–º–º–∏—Ç**: `refactor(stage-2.1): extract complete/skip step to use-cases`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ**:
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
   - `storage/step_repo.py` ‚Äî get_step, mark_completed, mark_skipped
   - `storage/user_repo.py` ‚Äî get_user, update_xp, update_streak
   - `storage/daily_log_repo.py` ‚Äî get_or_create_daily_log, log_completion, log_step_skip
   - `storage/stage_repo.py` ‚Äî get_stage, update_stage_progress, mark_stage_completed

2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –¥–æ–º–µ–π–Ω-—Ñ—É–Ω–∫—Ü–∏–∏:
   - `core/domain/gamification.py` ‚Äî calculate_xp_reward(step), calculate_streak(user, date)
   - `core/domain/step_rules.py` ‚Äî can_complete_step(step), can_skip_step(step)

3. ‚úÖ –°–æ–∑–¥–∞—Ç—å use-cases:
   - `core/use_cases/complete_step.py` ‚Äî CompleteStepUseCase
   - `core/use_cases/skip_step.py` ‚Äî SkipStepUseCase

4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å handler:
   - `src/bot/handlers/steps.py` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å use-cases (thin handler)
   - –£–¥–∞–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `update_stage_progress` (—Ç–µ–ø–µ—Ä—å –≤–Ω—É—Ç—Ä–∏ use-case)
   - Handler —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –≤—ã–∑—ã–≤–∞–µ—Ç use-case –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã: —É—Å–ø–µ—à–Ω–æ

6. ‚úÖ –ö–æ–º–º–∏—Ç: `refactor(stage-2.1): extract complete/skip step to use-cases`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ** (steps.py):
- –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ handler (XP, streak, DailyLog, stage progress)
- –§—É–Ω–∫—Ü–∏—è `update_stage_progress` –≤ handler (54 —Å—Ç—Ä–æ–∫–∏)
- 485 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

**–°—Ç–∞–ª–æ**:
- **Handler** (steps.py): —Ç–æ–Ω–∫–∏–π, —Ç–æ–ª—å–∫–æ UI-–ª–æ–≥–∏–∫–∞ (–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã, —Å–æ–æ–±—â–µ–Ω–∏—è, FSM)
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏** (storage/): —Ç—É–ø—ã–µ CRUD, –±–µ–∑ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- **–î–æ–º–µ–π–Ω** (core/domain/): —á–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ë–î
- **Use-cases** (core/use_cases/): –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ + –¥–æ–º–µ–π–Ω

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –≠—Ç–∞–ø 2.2 - –£—Ç—Ä–µ–Ω–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π (Morning Assignment Use-Case)

---

#### ‚úÖ 2.2: –£—Ç—Ä–µ–Ω–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π (Morning Assignment Use-Case)

**–°—Ç–∞—Ç—É—Å**: –ó–∞–≤–µ—Ä—à–µ–Ω
**–î–∞—Ç–∞**: 2025-12-13
**–ö–æ–º–º–∏—Ç**: `5bf5667` - refactor(stage-2.2): extract morning assignment to use-case

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ**:
1. ‚úÖ –°–æ–∑–¥–∞–Ω `storage/goal_repo.py`:
   - get_active_goal, get_active_goals
   - get_active_stage, get_all_active_stages
   - get_pending_stages, get_all_stages
   - create_stage, update_stage_status, save_goal, save_stage

2. ‚úÖ –°–æ–∑–¥–∞–Ω `core/domain/step_generation.py`:
   - energy_from_tension(tension) ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è –≤ —ç–Ω–µ—Ä–≥–∏—é
   - select_step_difficulty(energy) ‚Äî –≤—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —à–∞–≥–∞
   - calculate_max_step_duration(energy, is_micro) ‚Äî —Ä–∞—Å—á–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - calculate_xp_for_step(difficulty, duration) ‚Äî —Ä–∞—Å—á–µ—Ç XP
   - should_offer_deepen(before, after) ‚Äî –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —É–≥–ª—É–±–ª–µ–Ω–∏—è
   - calculate_steps_count_by_energy(energy) ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤

3. ‚úÖ –°–æ–∑–¥–∞–Ω `core/use_cases/assign_morning_steps.py`:
   - AssignMorningStepsUseCase —Å –º–µ—Ç–æ–¥–∞–º–∏:
     - ensure_active_stage(goal) ‚Äî –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —ç—Ç–∞–ø–∞
     - get_body_micro_action(user) ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–ª–µ—Å–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
     - create_body_step(user, goal, tension) ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ body —à–∞–≥–∞
     - create_task_micro_step(user, goal, tension, max_minutes) ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ task —à–∞–≥–∞

4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `src/storage/daily_log_repo.py`:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è log_step_assignment(daily_log, step_id, energy, mood)

5. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `src/storage/step_repo.py`:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è create_step(stage_id, title, difficulty, ...)

6. ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ä–æ–≤–∞–Ω `src/bot/handlers/morning.py`:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç AssignMorningStepsUseCase –≤–º–µ—Å—Ç–æ session_service
   - Handler —Å—Ç–∞–ª —Ç–æ–Ω–∫–∏–º ‚Äî —Ç–æ–ª—å–∫–æ UI –ª–æ–≥–∏–∫–∞
   - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ use-case

7. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `src/storage/__init__.py`:
   - –≠–∫—Å–ø–æ—Ä—Ç goal_repo –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —á–µ—Ä–µ–∑ `from src.storage import goal_repo`

8. ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å: —É—Å–ø–µ—à–Ω–æ
9. ‚úÖ flake8 —á–∏—Å—Ç (–∏–≥–Ω–æ—Ä–∏—Ä—É—è E501 –¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏)

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–ë—ã–ª–æ** (session.py + morning.py):
- –í—Å—è –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —à–∞–≥–æ–≤ –≤ services/session.py
- Handler –Ω–∞–ø—Ä—è–º—É—é –≤—ã–∑—ã–≤–∞–µ—Ç session_service
- 268 —Å—Ç—Ä–æ–∫ –≤ session.py (ensure_active_stage, create_body_step, get_task_micro_action)

**–°—Ç–∞–ª–æ**:
- **Handler** (morning.py): —Ç–æ–Ω–∫–∏–π, —Ç–æ–ª—å–∫–æ UI-–ª–æ–≥–∏–∫–∞ (callback handling, FSM, keyboards)
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏** (goal_repo, step_repo, daily_log_repo): —Ç—É–ø—ã–µ CRUD –±–µ–∑ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- **–î–æ–º–µ–π–Ω** (step_generation.py): —á–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–∞ (energy, difficulty, XP)
- **Use-case** (assign_morning_steps.py): –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ + AI + domain rules

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –≠—Ç–∞–ø 2.3 - Stuck-–ª–æ–≥–∏–∫–∞ + –≤–∞—Ä–∏–∞–Ω—Ç—ã (Stuck Resolution Use-Case)

---

#### ‚¨ú 2.3: Stuck-–ª–æ–≥–∏–∫–∞ + –≤–∞—Ä–∏–∞–Ω—Ç—ã (Stuck Resolution Use-Case)

**–°—Ç–∞—Ç—É—Å**: –ù–µ –Ω–∞—á–∞—Ç–æ

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å**:
1. –°–æ–∑–¥–∞—Ç—å –¥–æ–º–µ–π–Ω-—Ñ—É–Ω–∫—Ü–∏–∏:
   - `core/domain/stuck_rules.py` ‚Äî is_stuck(user), generate_microhit_options(blocker_type) ‚Üí list[str]

2. –°–æ–∑–¥–∞—Ç—å use-case:
   - `core/use_cases/resolve_stuck.py` ‚Äî ResolveStuckUseCase

3. –û–±–Ω–æ–≤–∏—Ç—å handler:
   - `src/bot/handlers/stuck.py` ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤** –º–∏–∫—Ä–æ–¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ –≤—ã–±–æ—Ä

4. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç: `tests/test_stuck_resolution_scenario.py`

5. –ü—Ä–æ–≥–Ω–∞—Ç—å —Ä—É–∫–∞–º–∏: /stuck ‚Üí –≤—ã–±—Ä–∞—Ç—å –±–ª–æ–∫–µ—Ä ‚Üí –ø–æ–ª—É—á–∏—Ç—å **–≤–∞—Ä–∏–∞–Ω—Ç—ã** ‚Üí –≤—ã–±—Ä–∞—Ç—å ‚Üí –≤—ã–ø–æ–ª–Ω–∏—Ç—å

6. –ö–æ–º–º–∏—Ç: `feat(stage-2.3): add stuck resolution use-case with multiple microhit options`

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: Stuck-–ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞, –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞ –≤—ã–±–æ—Ä

---

#### ‚¨ú 2.4: –í–µ—á–µ—Ä–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π (Evening Reflection Use-Case)

**–°—Ç–∞—Ç—É—Å**: –ù–µ –Ω–∞—á–∞—Ç–æ

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å**:
1. –°–æ–∑–¥–∞—Ç—å –¥–æ–º–µ–π–Ω-—Ñ—É–Ω–∫—Ü–∏–∏:
   - `core/domain/reflection_rules.py` ‚Äî calculate_daily_progress(user, date), generate_feedback(progress)

2. –°–æ–∑–¥–∞—Ç—å use-case:
   - `core/use_cases/complete_daily_reflection.py` ‚Äî CompleteDailyReflectionUseCase

3. –û–±–Ω–æ–≤–∏—Ç—å handler:
   - `src/bot/handlers/evening.py`

4. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç: `tests/test_evening_reflection_scenario.py`

5. –ü—Ä–æ–≥–Ω–∞—Ç—å —Ä—É–∫–∞–º–∏: /evening —Ñ–ª–æ—É

6. –ö–æ–º–º–∏—Ç: `refactor(stage-2.4): extract evening reflection to use-case`

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í–µ—á–µ—Ä–Ω–∏–π —Ñ–ª–æ—É –Ω–µ–∑–∞–≤–∏—Å–∏–º –æ—Ç aiogram

---

#### ‚¨ú 2.5: –ó–∞–∫—Ä—ã—Ç—å –±–∞–≥ —Å "–ò–∑–º–µ–Ω–∏—Ç—å"

**–°—Ç–∞—Ç—É—Å**: –ù–µ –Ω–∞—á–∞—Ç–æ

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å**:
1. –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –±–∞–≥: handlers/start.py (–∫–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å" —É–¥–∞–ª—è–µ—Ç —Ü–µ–ª—å?)
2. –ó–∞—Ñ–∏–∫—Å–∏—Ç—å –±–∞–≥
3. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç: `tests/test_edit_goal_flow.py`
4. –ö–æ–º–º–∏—Ç: `fix(stage-2.5): fix edit goal button flow`

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π UX –±–∞–≥ –∑–∞–∫—Ä—ã—Ç

---

#### ‚¨ú 2.6: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

**–°—Ç–∞—Ç—É—Å**: –ù–µ –Ω–∞—á–∞—Ç–æ

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å**:
1. –ü—Ä–æ–≥–Ω–∞—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã: `pytest`
2. –ü—Ä–æ–≥–Ω–∞—Ç—å —Ä—É–∫–∞–º–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–ª–æ—É:
   - –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí —Ü–µ–ª—å ‚Üí /morning ‚Üí –≤—ã–ø–æ–ª–Ω–∏—Ç—å —à–∞–≥ ‚Üí /evening
   - /stuck ‚Üí –≤—ã–±—Ä–∞—Ç—å –±–ª–æ–∫–µ—Ä ‚Üí –º–∏–∫—Ä–æ—É–¥–∞—Ä ‚Üí –≤—ã–ø–æ–ª–Ω–∏—Ç—å
3. –û–±–Ω–æ–≤–∏—Ç—å `docs/TMA_PROGRESS.md` ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –≠—Ç–∞–ø 2 –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º
4. –ö–æ–º–º–∏—Ç: `docs(stage-2.6): update TMA_PROGRESS.md for Stage 2 completion`

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –≠—Ç–∞–ø 2 –∑–∞–≤–µ—Ä—à—ë–Ω, –ª–æ–≥–∏–∫–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –≠—Ç–∞–ø–∞ 3/4

---

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≠—Ç–∞–ø–∞ 2:

1. ‚úÖ **–ù–ï "–ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å—ë"** ‚Äî –ø–æ –æ–¥–Ω–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é, –ø—Ä–æ–≥–Ω–∞—Ç—å —Ä—É–∫–∞–º–∏, –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
2. ‚úÖ **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ = —Ç—É–ø—ã–µ** ‚Äî —Ç–æ–ª—å–∫–æ CRUD, –±–µ–∑ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
3. ‚úÖ **–î–æ–º–µ–π–Ω = —á–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** ‚Äî –±–µ–∑ –ë–î, –±–µ–∑ Telegram
4. ‚úÖ **Use-cases = –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è** ‚Äî —Å–≤—è–∑—ã–≤–∞—é—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ + –¥–æ–º–µ–π–Ω + AI
5. ‚úÖ **Handlers = —Ç–æ–Ω–∫–∏–µ** ‚Äî –ø—Ä–∏–Ω—è—Ç—å –≤–≤–æ–¥ ‚Üí –≤—ã–∑–≤–∞—Ç—å use-case ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
6. ‚úÖ **–¢–µ—Å—Ç –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ sub-stage** ‚Äî —Ä—É–∫–∞–º–∏ + pytest
7. ‚úÖ **–¶–µ–ª—å –ù–ï "–∏–¥–µ–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"** ‚Äî –∞ —á—Ç–æ–±—ã –≠—Ç–∞–ø 3/4 —Å—Ç–∞–ª–∏ –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–º–∏

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

**–†–∞–∑–º–µ—Ä –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã handlers/**:

| –î–æ              | –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1.1 | –¶–µ–ª—å –ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1 |
|-----------------|------------------|---------------------|
| ~70KB           | ~54.5KB          | ~40KB              |

**–ú–æ–¥–µ–ª–∏ –ë–î**:

| –î–æ              | –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1.1 | –¶–µ–ª—å –ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1 |
|-----------------|------------------|---------------------|
| User, Goal, Stage, Step, DailyLog, QuizResult | User, Goal, Stage, Step, DailyLog | –¢–æ –∂–µ (QuizResult —É–¥–∞–ª–µ–Ω) |

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –±–∞–≥–∏ (—á–∏–Ω–∏—Ç—å –ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1)

1. **–ö–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å" —É–¥–∞–ª—è–µ—Ç —Ü–µ–ª—å** (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - –î–æ–ª–∂–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∞–ø—ã, –∞ –Ω–µ —É–¥–∞–ª—è—Ç—å —Ü–µ–ª—å
   - –ù—É–∂–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/edit_goal` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
   - –ù—É–∂–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å" —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø–æ—Å–ª–µ TMA MVP)

–°–º. `docs/BACKLOG.md`:
- –ó–∞–º–µ–Ω–∞ OpenAI ‚Üí Claude Sonnet 4.5
- –ñ–µ—Å—Ç–∫–∏–π —Ç–æ–Ω (–ø—É—à –∫ –¥–µ–π—Å—Ç–≤–∏—é)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –º–∏–∫—Ä–æ–¥–µ–π—Å—Ç–≤–∏–π
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–æ–π
- –£—Å–∏–ª–µ–Ω–Ω–∞—è –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-12-12, **–≠—Ç–∞–ø 1 –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù** (1.1-1.5) ‚úÖ
