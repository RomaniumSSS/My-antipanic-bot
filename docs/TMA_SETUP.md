# Telegram Mini App (TMA) Setup

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é Telegram Mini App –∫ –±–æ—Ç—É Antipanic.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot   ‚îÇ ‚Üê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç /start, /app
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚îÄ‚îÄ –ö–Ω–æ–ø–∫–∞ "üì± App" ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç TMA
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Telegram Mini App (TMA)                  ‚îÇ
‚îÇ         Next.js @ Vercel                         ‚îÇ
‚îÇ         https://your-tma-app.vercel.app          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ HTTP requests —Å Telegram auth header
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         FastAPI Backend                          ‚îÇ
‚îÇ         https://your-bot.railway.app             ‚îÇ
‚îÇ         –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã: /api/me, /api/microhit, etc.  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PostgreSQL    ‚îÇ
‚îÇ   (Railway)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Telegram Bot** (–æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –Ω–∞ Railway)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã `/start`, `/morning`, `/stuck`, etc.
   - –ò–º–µ–µ—Ç –∫–Ω–æ–ø–∫—É "üì± App" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é –¥–ª—è –∑–∞–ø—É—Å–∫–∞ TMA
   - –ö–æ–º–∞–Ω–¥–∞ `/app` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ TMA

2. **TMA Frontend** (Next.js –Ω–∞ Vercel)
   - UI –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è, –º–∏–∫—Ä–æ-–¥–µ–π—Å—Ç–≤–∏–π, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram WebApp SDK –¥–ª—è auth
   - URL: –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ @BotFather

3. **FastAPI Backend** (—á–∞—Å—Ç—å –±–æ—Ç–∞ –Ω–∞ Railway)
   - REST API –¥–ª—è TMA
   - –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã: `/api/me`, `/api/microhit/generate`, `/api/microhit/complete`, etc.
   - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram WebApp initData

---

## –®–∞–≥ 1: –î–µ–ø–ª–æ–π FastAPI Backend

FastAPI backend —É–∂–µ –≤–∫–ª—é—á–µ–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–µ–∫—Ç –∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ Railway –≤–º–µ—Å—Ç–µ —Å –±–æ—Ç–æ–º.

### 1.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã API

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –±–æ—Ç–∞ –Ω–∞ Railway, API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
```
https://your-bot.railway.app/api/me
https://your-bot.railway.app/api/microhit/generate
...
```

### 1.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS

–í `src/interfaces/api/main.py` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω CORS –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Vercel:

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # –í production —É–∫–∞–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–æ–º–µ–Ω Vercel
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è production**: –ó–∞–º–µ–Ω–∏ `allow_origins=["*"]` –Ω–∞:
```python
allow_origins=[
    "https://your-tma-app.vercel.app",
    "https://your-tma-app-*.vercel.app",  # preview deployments
]
```

---

## –®–∞–≥ 2: –î–µ–ø–ª–æ–π TMA Frontend –Ω–∞ Vercel

### 2.1. –ß–µ—Ä–µ–∑ Vercel CLI

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Vercel CLI
npm i -g vercel

# –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É TMA frontend
cd tma-frontend

# –î–µ–ø–ª–æ–π
vercel

# –°–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º:
# - Link to existing project? ‚Üí No
# - Project name? ‚Üí antipanic-tma
# - Directory? ‚Üí ./
# - Override settings? ‚Üí No
```

### 2.2. –ß–µ—Ä–µ–∑ Vercel Dashboard

1. –ó–∞–π–¥–∏ –Ω–∞ https://vercel.com
2. New Project ‚Üí Import Git Repository
3. –í—ã–±–µ—Ä–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `My-antipanic-bot`
4. **Root Directory**: —É—Å—Ç–∞–Ω–æ–≤–∏ `tma-frontend`
5. **Framework Preset**: Next.js (auto-detect)
6. **Environment Variables**: –î–æ–±–∞–≤—å:
   - `NEXT_PUBLIC_API_URL` = `https://your-bot.railway.app` (URL —Ç–≤–æ–µ–≥–æ Railway –±–æ—Ç–∞)
7. Deploy

### 2.3. –ü–æ–ª—É—á–µ–Ω–∏–µ URL

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è Vercel –¥–∞—Å—Ç URL –≤–∏–¥–∞:
```
https://antipanic-tma.vercel.app
```

–°–æ—Ö—Ä–∞–Ω–∏ —ç—Ç–æ—Ç URL ‚Äî –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞.

---

## –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ @BotFather

### 3.1. –°–æ–∑–¥–∞–Ω–∏–µ Web App

1. –û—Ç–∫—Ä–æ–π [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å `/mybots`
3. –í—ã–±–µ—Ä–∏ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞
4. **Web App** ‚Üí **Create Web App**
5. –í–≤–µ–¥–∏ –¥–∞–Ω–Ω—ã–µ:
   - **Title**: `Antipanic App`
   - **Description**: `–ú–∏–∫—Ä–æ-–¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–∏`
   - **Photo**: (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∑–∞–≥—Ä—É–∑–∏ –∏–∫–æ–Ω–∫—É)
   - **Web App URL**: `https://antipanic-tma.vercel.app` (URL –∏–∑ Vercel)
   - **Short name**: `antipanic` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ URL –≤–∏–¥–∞ t.me/your_bot/antipanic)

6. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ —Å–æ–∑–¥–∞–Ω–∏–µ

### 3.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Menu Button (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫–Ω–æ–ø–∫—É Menu (—Å–ª–µ–≤–∞ –æ—Ç –ø–æ–ª—è –≤–≤–æ–¥–∞) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ TMA:

1. –í [@BotFather](https://t.me/BotFather)
2. `/mybots` ‚Üí –≤—ã–±–µ—Ä–∏ –±–æ—Ç–∞
3. **Bot Settings** ‚Üí **Menu Button** ‚Üí **Edit Menu Button URL**
4. –í–≤–µ–¥–∏ URL: `https://antipanic-tma.vercel.app`
5. –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Ç–∫—Ä—ã—Ç—å TMA —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É Menu

---

## –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π TMA_URL –≤ –±–æ—Ç–µ

–ß—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ "üì± App" –∏ –∫–æ–º–∞–Ω–¥–∞ `/app` —Ä–∞–±–æ—Ç–∞–ª–∏ –≤ –±–æ—Ç–µ, –Ω—É–∂–Ω–æ –∑–∞–¥–∞—Ç—å `TMA_URL`.

### 4.1. –í Railway

1. –ó–∞–π–¥–∏ –≤ Railway Dashboard ‚Üí –¢–≤–æ–π –ø—Ä–æ–µ–∫—Ç ‚Üí –ë–æ—Ç —Å–µ—Ä–≤–∏—Å
2. **Variables** ‚Üí **+ New Variable**
3. –î–æ–±–∞–≤—å:
   ```
   TMA_URL=https://antipanic-tma.vercel.app
   ```
4. –ù–∞–∂–º–∏ **Deploy** (Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –±–æ—Ç)

### 4.2. –í –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

–í `.env` —Ñ–∞–π–ª–µ –¥–æ–±–∞–≤—å:
```bash
TMA_URL=https://antipanic-tma.vercel.app
```

–ò–ª–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
TMA_URL=http://localhost:3000
```

---

## –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 5.1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –º–µ–Ω—é

1. –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞–ø–∏—à–∏ `/start`
3. –í –º–µ–Ω—é –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ **üì± App**
4. –ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É ‚Üí –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è TMA

### 5.2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /app

1. –ù–∞–ø–∏—à–∏ `/app`
2. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π "üöÄ –û—Ç–∫—Ä—ã—Ç—å App"
3. –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ‚Üí –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è TMA

### 5.3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É TMA

1. –ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è TMA –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:
   - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–º—è, XP, level, streak)
   - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–∏–∫—Ä–æ-–¥–µ–π—Å—Ç–≤–∏–π

2. –ü–æ–ø—Ä–æ–±—É–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–∫—Ä–æ-–¥–µ–π—Å—Ç–≤–∏–µ:
   - –í–≤–µ–¥–∏ –∑–∞–¥–∞—á—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–¥")
   - –í—ã–±–µ—Ä–∏ blocker (–Ω–∞–ø—Ä–∏–º–µ—Ä, "fear")
   - –ù–∞–∂–º–∏ "Generate" ‚Üí –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è 2-3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –º–∏–∫—Ä–æ-–¥–µ–π—Å—Ç–≤–∏–π

3. –ù–∞–∂–º–∏ "I Did It! +XP" ‚Üí XP –¥–æ–ª–∂–µ–Ω —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è

### 5.4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –Ω–∞–ø—Ä—è–º—É—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health check
curl https://your-bot.railway.app/api/health

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å dev endpoint (–±–µ–∑ auth)
curl https://your-bot.railway.app/api/dev/test
```

---

## Troubleshooting

### –û—à–∏–±–∫–∞: "This app only works inside Telegram"

**–ü—Ä–∏—á–∏–Ω–∞**: TMA –æ—Ç–∫—Ä—ã—Ç –Ω–µ –≤ Telegram (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞–ø—Ä—è–º—É—é).

**–†–µ—à–µ–Ω–∏–µ**: –û—Ç–∫—Ä—ã–≤–∞–π TMA —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –≤ Telegram.

---

### –û—à–∏–±–∫–∞: "API Connection Failed"

**–ü—Ä–∏—á–∏–Ω–∞**: Frontend –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Backend.

**–ü—Ä–æ–≤–µ—Ä—å**:
1. `NEXT_PUBLIC_API_URL` –≤ Vercel –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å URL Railway –±–æ—Ç–∞)
2. FastAPI backend –∑–∞–ø—É—â–µ–Ω –Ω–∞ Railway
3. CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `src/interfaces/api/main.py`

**Debug**:
```bash
# –í –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—Ä–æ—Å—ã
# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ CORS, –¥–æ–±–∞–≤—å –¥–æ–º–µ–Ω Vercel –≤ allow_origins
```

---

### –ö–Ω–æ–ø–∫–∞ "üì± App" –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: `TMA_URL` –Ω–µ –∑–∞–¥–∞–Ω –≤ env.

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ `TMA_URL` –¥–æ–±–∞–≤–ª–µ–Ω –≤ Railway Variables
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –±–æ—Ç (Railway ‚Üí Deployments ‚Üí Redeploy)
3. –ù–∞–ø–∏—à–∏ `/start` —Å–Ω–æ–≤–∞

---

### TMA –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Unauthorized"

**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–±–ª–µ–º–∞ —Å Telegram WebApp auth.

**–ü—Ä–æ–≤–µ—Ä—å**:
1. TMA –æ—Ç–∫—Ä—ã—Ç –∏–º–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ Telegram (–Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
2. BOT_TOKEN –≤ Railway –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. FastAPI auth middleware —Ä–∞–±–æ—Ç–∞–µ—Ç (`src/interfaces/api/auth.py`)

**Debug**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Railway –±–æ—Ç–∞
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Telegram auth
```

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TMA

### –û–±–Ω–æ–≤–∏—Ç—å Frontend (Vercel)

1. –í–Ω–µ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `tma-frontend/`
2. –ó–∞–∫–æ–º–º–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å –≤ Git
3. Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
4. –ò–ª–∏ –≤—Ä—É—á–Ω—É—é: `cd tma-frontend && vercel --prod`

### –û–±–Ω–æ–≤–∏—Ç—å Backend API (Railway)

1. –í–Ω–µ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/interfaces/api/`
2. –ó–∞–∫–æ–º–º–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å –≤ Git
3. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é

---

## –ü—Ä–æ–¥–∞–∫—à–Ω Best Practices

### 1. CORS Security

–í `src/interfaces/api/main.py` —É–∫–∞–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã:
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://antipanic-tma.vercel.app",
        "https://antipanic-tma-*.vercel.app",  # preview branches
    ],
    allow_credentials=True,
    allow_methods=["GET", "POST"],
    allow_headers=["Content-Type", "X-Telegram-Init-Data"],
)
```

### 2. Rate Limiting

–î–æ–±–∞–≤—å rate limiting –¥–ª—è API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:
```bash
pip install slowapi
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- Railway: –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Metrics ‚Üí CPU, Memory, Logs)
- Vercel: Analytics (–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–ª–∞—Ç–Ω–æ–º –ø–ª–∞–Ω–µ)

### 4. Secrets Rotation

–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–π:
- `BOT_TOKEN` (—á–µ—Ä–µ–∑ @BotFather ‚Üí /token)
- `OPENAI_KEY` (—á–µ—Ä–µ–∑ OpenAI dashboard)
- `CRON_TOKEN` (–≥–µ–Ω–µ—Ä–∏—Ä—É–π –Ω–æ–≤—ã–π —á–µ—Ä–µ–∑ `openssl rand -hex 32`)

---

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–ü–æ—Å–ª–µ –±–∞–∑–æ–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. **–ù–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ TMA**:
   - `/stats` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - `/history` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤
   - `/goals` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª—è–º–∏

2. **Offline mode**:
   - Service Worker –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
   - LocalStorage –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

3. **Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
   - Telegram Web Apps –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç native notifications

4. **Haptic feedback**:
   - –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö —á–µ—Ä–µ–∑ Telegram WebApp SDK

5. **Sharing**:
   - –ö–Ω–æ–ø–∫–∞ "Share" –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–∑–µ–π

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Telegram Bot API**: https://core.telegram.org/bots/api
- **Telegram WebApps Docs**: https://core.telegram.org/bots/webapps
- **Vercel Docs**: https://vercel.com/docs
- **Railway Docs**: https://docs.railway.app
- **Next.js Docs**: https://nextjs.org/docs
- **FastAPI Docs**: https://fastapi.tiangolo.com

---

**–≠—Ç–∞–ø 4.3 –ó–ê–í–ï–†–®–ï–ù!** üéâ

TMA —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å –±–æ—Ç–æ–º. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç:
- –û—Ç–∫—Ä—ã–≤–∞—Ç—å TMA —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "üì± App" –≤ –º–µ–Ω—é
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `/app` –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ —á–µ—Ä–µ–∑ —É–¥–æ–±–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
