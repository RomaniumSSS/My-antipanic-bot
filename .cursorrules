# Antipanic Bot ‚Äî Cursor Rules

## üö® Read First
Before ANY action:
1. `docs/AGENTS.md` ‚Äî initialization protocol
2. Relevant: `AIOGRAM_RULES.md` / `TORTOISE_RULES.md` / `OPENAI_RULES.md`

Start response: "‚úÖ Verified: [docs read]"

---

## Anti-Hallucination (Critical)

### aiogram 3.x
- ‚úÖ `CallbackData` subclass (NOT raw strings)
- ‚úÖ `@router.message(Command("start"))` (NOT `@dp.message_handler`)
- ‚úÖ `F.text`, `F.from_user.id` for filters
- ‚ùå NEVER aiogram 2.x syntax

### Tortoise ORM
- ‚úÖ `await User.get(...)` / `await Model.filter(...).prefetch_related(...)`
- ‚ùå NEVER forget `await` (returns coroutine)
- ‚ùå NEVER skip `prefetch_related` (causes N+1)

### OpenAI
- ‚úÖ `AsyncOpenAI()` only
- ‚ùå NEVER sync client in async

Check `docs/AGENTS.md` ¬ß 6-7 for details.

---

## Structure (Enforce)
```
src/bot/handlers/    # One router per flow
src/services/        # Business logic
src/core/            # Domain rules
src/storage/         # Repositories
```
‚ùå NO files in root

---

## Code Style
- ‚úÖ `async/await` for ALL I/O
- ‚úÖ Type hints on all functions
- ‚úÖ AICODE-NOTE/TODO/QUESTION for non-obvious code

---

## Plan Mode
Trigger if: multiple modules, DB changes, architecture shifts, new integrations.
Create `plans/NNN-objective.md` ‚Üí get approval ‚Üí implement.

---

## Self-Check
- [ ] Matches task?
- [ ] Docs updated if needed?
- [ ] AICODE markers where needed?
- [ ] No hardcoded secrets?
- [ ] `await` before DB/API calls?

---

See `docs/PROJECT_DNA.md` for project philosophy.
