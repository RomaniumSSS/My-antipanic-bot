# –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Telegram Mini App (TMA)

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

- **–¢–µ–∫—É—â–∞—è –≤–µ—Ç–∫–∞**: `clean-backend` ‚Äî —á–∏—Å—Ç—ã–π —Ä–∞–±–æ—á–∏–π –±—ç–∫–µ–Ω–¥ –±–µ–∑ TMA
- **–ë—ç–∫–µ–Ω–¥**: Railway (https://my-antipanic-bot-production.up.railway.app)
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: –±—É–¥–µ—Ç –Ω–∞ Vercel (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
- **–°—Ç–∞—Ç—É—Å**: –±—ç–∫–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç, –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –≤ Telegram

---

## –§–∞–∑–∞ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ API –¥–ª—è TMA

### 2.1 –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–í `requirements.txt` –¥–æ–±–∞–≤–∏—Ç—å:
```
# FastAPI TMA dependencies
fastapi>=0.109.0
uvicorn[standard]>=0.27.0
python-multipart>=0.0.6
aiohttp-asgi>=0.6.0
aiohttp-cors>=0.7.0
```

### 2.2 –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É API

```
src/
‚îî‚îÄ‚îÄ interfaces/
    ‚îî‚îÄ‚îÄ api/
        ‚îú‚îÄ‚îÄ __init__.py
        ‚îú‚îÄ‚îÄ main.py          # FastAPI app
        ‚îú‚îÄ‚îÄ auth.py          # Telegram WebApp –≤–∞–ª–∏–¥–∞—Ü–∏—è
        ‚îú‚îÄ‚îÄ schemas.py       # Pydantic –º–æ–¥–µ–ª–∏
        ‚îî‚îÄ‚îÄ routers/
            ‚îú‚îÄ‚îÄ __init__.py
            ‚îú‚îÄ‚îÄ user.py      # GET /api/me
            ‚îú‚îÄ‚îÄ goal.py      # GET/POST /api/goals
            ‚îú‚îÄ‚îÄ stats.py     # GET /api/stats
            ‚îî‚îÄ‚îÄ microhit.py  # POST /api/microhit
```

### 2.3 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å endpoints

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/api/me` | GET | –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `/api/goals` | GET | –°–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–π |
| `/api/goals/{id}` | GET | –î–µ—Ç–∞–ª–∏ —Ü–µ–ª–∏ |
| `/api/stats` | GET | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `/api/microhit` | POST | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–∫—Ä–æ-–¥–µ–π—Å—Ç–≤–∏—è |

### 2.4 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

- –í–∞–ª–∏–¥–∞—Ü–∏—è `initData` –∏–∑ Telegram WebApp
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ —á–µ—Ä–µ–∑ BOT_TOKEN
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ user_id –∏–∑ initData

### 2.5 –°–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å FastAPI –Ω–∞ aiohttp

–í `src/main.py` –¥–æ–±–∞–≤–∏—Ç—å:
```python
from aiohttp_asgi import ASGIResource
from src.interfaces.api.main import app as fastapi_app

# –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è aiohttp app:
asgi_resource = ASGIResource(fastapi_app)
app.router.add_route("*", "/api{path_info:.*}", asgi_resource)
```

### 2.6 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS

```python
import aiohttp_cors

cors_origins = [
    "http://localhost:3000",
    # Vercel –¥–æ–º–µ–Ω –¥–æ–±–∞–≤–∏–º –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
]

cors = aiohttp_cors.setup(app, defaults={...})
```

### 2.7 –î–µ–ø–ª–æ–π –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
git add -A
git commit -m "feat(api): add FastAPI endpoints for TMA"
git push origin clean-backend
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
- `GET /api/me` –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 401 (–Ω–µ—Ç auth)
- `GET /health` –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å

---

## –§–∞–∑–∞ 3: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ Vercel

### 3.1 –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
# –í–∞—Ä–∏–∞–Ω—Ç A: –ù–æ–≤—ã–π —Ä–µ–ø–æ –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
cd ~/
mkdir antipanic-tma-frontend
cp -r ~/My-antipanic-bot/tma-frontend/* antipanic-tma-frontend/
cd antipanic-tma-frontend
git init
git add .
git commit -m "init: TMA frontend for Antipanic Bot"
```

```bash
# –í–∞—Ä–∏–∞–Ω—Ç B: –°–æ–∑–¥–∞—Ç—å —Å –Ω—É–ª—è —á–µ—Ä–µ–∑ create-next-app
npx create-next-app@14 antipanic-tma-frontend --typescript --tailwind --app
```

### 3.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

```
antipanic-tma-frontend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx           # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îî‚îÄ‚îÄ globals.css
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ api.ts             # API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ telegram.ts        # Telegram WebApp SDK
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ UserProfile.tsx
‚îÇ   ‚îú‚îÄ‚îÄ GoalCard.tsx
‚îÇ   ‚îî‚îÄ‚îÄ MicroHitGenerator.tsx
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ next.config.js
‚îî‚îÄ‚îÄ package.json
```

### 3.3 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å API –∫–ª–∏–µ–Ω—Ç

```typescript
// lib/api.ts
const API_URL = process.env.NEXT_PUBLIC_API_URL;

export async function fetchAPI(endpoint: string) {
  const tg = window.Telegram?.WebApp;
  const initData = tg?.initData || "";
  
  const res = await fetch(`${API_URL}${endpoint}`, {
    headers: {
      "Authorization": `tma ${initData}`,
      "Content-Type": "application/json",
    },
  });
  return res.json();
}
```

### 3.4 –ó–∞–ª–∏—Ç—å –Ω–∞ GitHub

```bash
gh repo create RomaniumSSS/antipanic-tma-frontend --public
git remote add origin https://github.com/RomaniumSSS/antipanic-tma-frontend.git
git push -u origin main
```

### 3.5 –î–µ–ø–ª–æ–π –Ω–∞ Vercel

1. –ó–∞–π—Ç–∏ –Ω–∞ https://vercel.com
2. Import Git Repository ‚Üí –≤—ã–±—Ä–∞—Ç—å `antipanic-tma-frontend`
3. Environment Variables:
   - `NEXT_PUBLIC_API_URL` = `https://my-antipanic-bot-production.up.railway.app`
4. Deploy

### 3.6 –ü–æ–ª—É—á–∏—Ç—å –¥–æ–º–µ–Ω

Vercel –¥–∞—Å—Ç –¥–æ–º–µ–Ω —Ç–∏–ø–∞:
`https://antipanic-tma-frontend.vercel.app`

---

## –§–∞–∑–∞ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### 4.1 –î–æ–±–∞–≤–∏—Ç—å Vercel –¥–æ–º–µ–Ω –≤ CORS –±—ç–∫–µ–Ω–¥–∞

–í `src/main.py` –∏–ª–∏ `src/interfaces/api/main.py`:
```python
cors_origins = [
    "http://localhost:3000",
    "https://antipanic-tma-frontend.vercel.app",  # ‚Üê –¥–æ–±–∞–≤–∏—Ç—å
]
```

### 4.2 –û–±–Ω–æ–≤–∏—Ç—å TMA_URL –≤ Railway

–í Railway ‚Üí My-antipanic-bot ‚Üí Variables:
```
TMA_URL=https://antipanic-tma-frontend.vercel.app
```

### 4.3 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –±–æ—Ç–µ

–í —Ö–µ–Ω–¥–ª–µ—Ä–µ –¥–æ–±–∞–≤–∏—Ç—å inline –∫–Ω–æ–ø–∫—É —Å WebApp:
```python
from aiogram.types import InlineKeyboardButton, WebAppInfo

button = InlineKeyboardButton(
    text="üöÄ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
    web_app=WebAppInfo(url="https://antipanic-tma-frontend.vercel.app")
)
```

### 4.4 –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å Menu Button –≤ BotFather

```
/mybots ‚Üí @your_bot ‚Üí Bot Settings ‚Üí Menu Button
‚Üí Configure menu button
‚Üí URL: https://antipanic-tma-frontend.vercel.app
‚Üí Title: –û—Ç–∫—Ä—ã—Ç—å
```

### 4.5 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –º–µ–Ω—é –∏–ª–∏ inline –∫–Ω–æ–ø–∫—É
3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ TMA –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å API

---

## –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –ë—ç–∫–µ–Ω–¥
- [x] FastAPI endpoints —Ä–∞–±–æ—Ç–∞—é—Ç (`/api/me`, `/api/goals`, `/api/stats`, `/api/microhit`)
- [x] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω (localhost:3000 + TMA_URL env var)
- [x] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ initData —Ä–∞–±–æ—Ç–∞–µ—Ç (`auth.py`)
- [x] `/api/me` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (auto-creates if not exists)
- [x] FastAPI –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ aiohttp —á–µ—Ä–µ–∑ ASGI adapter

### –§—Ä–æ–Ω—Ç–µ–Ω–¥
- [x] –î–µ–ø–ª–æ–π –Ω–∞ Vercel —É—Å–ø–µ—à–µ–Ω (https://antipanic-tma-frontend.vercel.app)
- [x] GitHub —Ä–µ–ø–æ: https://github.com/RomaniumSSS/antipanic-tma-frontend
- [x] API –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [x] Telegram WebApp SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
- [x] –î–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [x] TMA_URL –¥–æ–±–∞–≤–ª–µ–Ω –≤ Railway
- [x] /app –∫–æ–º–∞–Ω–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–æ—Ç–∞
- [x] TMA –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏–∑ Telegram
- [x] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [x] –í—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –≤ TMA ‚úÖ DONE 2024-12-15

---

## –í–∞–∂–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- Railway –±—ç–∫–µ–Ω–¥: https://my-antipanic-bot-production.up.railway.app
- Telegram WebApp Docs: https://core.telegram.org/bots/webapps
- Vercel Docs: https://vercel.com/docs

---

## –§–∞–∑–∞ 5: –†–∞–∑–≤–∏—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ TMA

### –°—Ç–∞—Ç—É—Å: üöß –í —Ä–∞–±–æ—Ç–µ

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.

### 5.1 –ñ–µ—Å—Ç–∫–∏–π —Ç–æ–Ω –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî•üî•üî•)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ë–æ—Ç —Å–ª–∏—à–∫–æ–º –º—è–≥–∫–∏–π ("–ü–æ–ø—Ä–æ–±—É–π...", "–ú–æ–∂–µ—Ç –±—ã—Ç—å...")
**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –≤ drill sergeant —Å—Ç–∏–ª–µ

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è**:
- `src/services/ai.py` ‚Äî –≤—Å–µ system prompts

**–ü—Ä–∏–º–µ—Ä—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏**:
```
‚ùå "–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –∏ –Ω–∞–ø–∏—Å–∞—Ç—å –ø–∞—Ä—É —Å—Ç—Ä–æ–∫"
‚úÖ "–û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª. –ü—Ä—è–º–æ —Å–µ–π—á–∞—Å. –ù–∞–ø–∏—à–∏ —Ö–æ—Ç—å —á—Ç–æ-—Ç–æ. 2 –º–∏–Ω—É—Ç—ã."

‚ùå "–í–æ–∑–º–æ–∂–Ω–æ, —Ç—ã –∑–∞—Å—Ç—Ä—è–ª –∏–∑-–∑–∞ —Å—Ç—Ä–∞—Ö–∞"
‚úÖ "–ó–∞—Å—Ç—Ä—è–ª? –ù–æ—Ä–º. –ù–æ —Å–∏–¥–µ—Ç—å –¥–∞–ª—å—à–µ ‚Äî —Ö—É–∂–µ. –î–µ–ª–∞–µ–º –º–∏–∫—Ä–æ—à–∞–≥. –°–µ–π—á–∞—Å."
```

**–°—Ç–∞—Ç—É—Å**: [x] –ó–∞–≤–µ—Ä—à–µ–Ω–æ 2024-12-15

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã**:
- `SYSTEM_PROMPT` ‚Äî drill sergeant —Å—Ç–∏–ª—å
- `STEPS_PROMPT` ‚Äî –¥–∏—Ä–µ–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `MICRO_STEP_PROMPT` ‚Äî –∂—ë—Å—Ç–∫–∏–π —Ç–æ–Ω
- `MICROHIT_PROMPT` ‚Äî –±–µ–∑ —Å–æ—á—É–≤—Å—Ç–≤–∏—è
- `QUIZ_DIAGNOSIS_SYSTEM_PROMPT` ‚Äî –ø—Ä—è–º–∞—è –ø—Ä–∞–≤–¥–∞
- `DECOMPOSE_PROMPT` ‚Äî –±–µ–∑ –≤–æ–¥—ã

---

### 5.2 –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ç–∞–ª–µ–π —Ü–µ–ª–∏ –≤ TMA (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî•üî•)

**–ß—Ç–æ –Ω—É–∂–Ω–æ**:
- –†–æ—É—Ç `/goals/[id]` –≤ Next.js
- –ü–æ–∫–∞–∑ —ç—Ç–∞–ø–æ–≤ (stages) —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞–º–∏
- –ü–æ–∫–∞–∑ —à–∞–≥–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ —ç—Ç–∞–ø–∞
- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π (–≤—ã–ø–æ–ª–Ω–∏—Ç—å —à–∞–≥, –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)

**–ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
```
tma-frontend/
‚îú‚îÄ‚îÄ app/goals/[id]/page.tsx    # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ç–∞–ª–µ–π
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ StageCard.tsx          # –ö–∞—Ä—Ç–æ—á–∫–∞ —ç—Ç–∞–ø–∞
‚îÇ   ‚îú‚îÄ‚îÄ StepItem.tsx           # –≠–ª–µ–º–µ–Ω—Ç —à–∞–≥–∞
‚îÇ   ‚îî‚îÄ‚îÄ ProgressBar.tsx        # –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
```

**API endpoints (—É–∂–µ –µ—Å—Ç—å)**:
- `GET /api/goals/{id}` ‚Äî –¥–µ—Ç–∞–ª–∏ —Ü–µ–ª–∏ —Å–æ —Å—Ç–∞–¥–∏—è–º–∏

**–°—Ç–∞—Ç—É—Å**: [x] –ó–∞–≤–µ—Ä—à–µ–Ω–æ 2024-12-15

**–ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**:
1. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
   - `ProgressBar.tsx` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
   - `StageCard.tsx` ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ —ç—Ç–∞–ø–∞ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º –∏ —Å—Ç–∞—Ç—É—Å–æ–º
   - `StepItem.tsx` ‚Äî —ç–ª–µ–º–µ–Ω—Ç —à–∞–≥–∞ (–≥–æ—Ç–æ–≤ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –≤ 5.3)

2. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ `/goals/[id]`**:
   - –î–µ—Ç–∞–ª–∏ —Ü–µ–ª–∏ (–∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å—Ç–∞—Ç—É—Å, –¥–µ–¥–ª–∞–π–Ω)
   - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞–º–∏
   - –í—ã–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —ç—Ç–∞–ø–∞
   - –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –¥–ª—è —à–∞–≥–æ–≤ (–±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ 5.3)
   - Back navigation

3. **–ù–∞–≤–∏–≥–∞—Ü–∏—è**:
   - –ü–µ—Ä–µ—Ö–æ–¥ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –¥–µ—Ç–∞–ª–∏ —Ü–µ–ª–∏ –ø–æ –∫–ª–∏–∫—É
   - Haptic feedback –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX

---

### 5.3 –®–∞–≥–∏ –¥–Ω—è + –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ TMA (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî•üî•)

**–ß—Ç–æ –Ω—É–∂–Ω–æ**:
- –°–µ–∫—Ü–∏—è "–®–∞–≥–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è" –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
- –ö–Ω–æ–ø–∫–∏ "‚úÖ –°–¥–µ–ª–∞–ª" / "‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ù–æ–≤—ã–µ endpoints**:
- `GET /api/steps/today` ‚Äî —à–∞–≥–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (–Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å)
- `POST /api/steps/{id}/complete` ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º
- `POST /api/steps/{id}/skip` ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å –ø—Ä–∏—á–∏–Ω–æ–π

**–°—Ç–∞—Ç—É—Å**: [ ] –ù–µ –Ω–∞—á–∞—Ç–æ

---

### 5.4 –ë–∞–≥: "–ò–∑–º–µ–Ω–∏—Ç—å" —É–¥–∞–ª—è–µ—Ç —Ü–µ–ª—å (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ TMA –º–∏–≥—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª—è–º–∏ –±—ã–ª —É–¥–∞–ª—ë–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å —Ü–µ–ª–∏.

**–†–µ—à–µ–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª—è–º–∏

**–°—Ç–∞—Ç—É—Å**: [x] –ó–∞–≤–µ—Ä—à–µ–Ω–æ 2024-12-15

**–ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**:

1. **CallbackData —Ñ–∞–±—Ä–∏–∫–∏** (`src/bot/callbacks/data.py`):
   - `GoalManageAction` ‚Äî –¥–µ–π—Å—Ç–≤–∏—è —Å —Ü–µ–ª—å—é (edit_stages, delete, complete, pause, resume)
   - `StageManageAction` ‚Äî –¥–µ–π—Å—Ç–≤–∏—è —Å —ç—Ç–∞–ø–∞–º–∏ (edit, delete, add)
   - `GoalManageCallback` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª—å—é
   - `StageManageCallback` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç—Ç–∞–ø–∞–º–∏

2. **FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è** (`src/bot/states.py`):
   - `GoalManageStates` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª—è–º–∏

3. **–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã** (`src/bot/keyboards.py`):
   - `goal_manage_keyboard()` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª—å—é
   - `stages_manage_keyboard()` ‚Äî —Å–ø–∏—Å–æ–∫ —ç—Ç–∞–ø–æ–≤
   - `confirm_delete_keyboard()` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è

4. **Handler** (`src/bot/handlers/manage_goals.py`):
   - `/goals` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ü–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π —Ü–µ–ª–∏
   - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ç–∞–ø–æ–≤ (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ)
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç—Ç–∞–ø–æ–≤
   - –£–¥–∞–ª–µ–Ω–∏–µ —ç—Ç–∞–ø–æ–≤ (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ)
   - –ü–∞—É–∑–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–π
   - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ü–µ–ª–µ–π
   - –£–¥–∞–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–π —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

5. **UI –∏–∑–º–µ–Ω–µ–Ω–∏—è**:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–¶–µ–ª–∏" –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
   - –û—Ç–¥–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏

---

## –§–∞–∑–∞ 6: –£–ª—É—á—à–µ–Ω–∏–µ AI

### 6.1 –ú–∏–≥—Ä–∞—Ü–∏—è OpenAI ‚Üí Claude Sonnet

**–ó–∞—á–µ–º**:
- –õ—É—á—à–µ CoT (chain of thought)
- –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–∫—Ä–æ–¥–µ–π—Å—Ç–≤–∏–π
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –∂–µ—Å—Ç–∫–∏–º —Ç–æ–Ω–æ–º

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
```python
# src/services/ai.py

# –ë—ã–ª–æ
from openai import AsyncOpenAI
client = AsyncOpenAI(api_key=config.OPENAI_KEY)

# –°—Ç–∞–ª–æ
from anthropic import AsyncAnthropic
client = AsyncAnthropic(api_key=config.ANTHROPIC_KEY)
```

**–ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
- `ANTHROPIC_KEY` ‚Äî API –∫–ª—é—á Anthropic

**–°—Ç–∞—Ç—É—Å**: [ ] –ù–µ –Ω–∞—á–∞—Ç–æ

---

### 6.2 –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –º–∏–∫—Ä–æ–¥–µ–π—Å—Ç–≤–∏–π

**–ß—Ç–æ –Ω—É–∂–Ω–æ**:
- AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 2-3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –º–∏–∫—Ä–æ–¥–µ–π—Å—Ç–≤–∏—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä**:
```
–ë–ª–æ–∫–µ—Ä: "–°—Ç—Ä–∞—Ö –Ω–∞—á–∞—Ç—å"

–í–∞—Ä–∏–∞–Ω—Ç 1 (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ): "–û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª. –ù–µ –ø–∏—à–∏. 30 —Å–µ–∫—É–Ω–¥."
–í–∞—Ä–∏–∞–Ω—Ç 2 (—á—É—Ç—å –±–æ–ª—å—à–µ): "–ù–∞–ø–∏—à–∏ –æ–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 2 –º–∏–Ω—É—Ç—ã."
–í–∞—Ä–∏–∞–Ω—Ç 3 (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞): "–ü–æ—Å—Ç–∞–≤—å —Ç–∞–π–º–µ—Ä –Ω–∞ 5 –º–∏–Ω—É—Ç. –î–µ–ª–∞–π —Ö—Ä–µ–Ω—å."
```

**–°—Ç–∞—Ç—É—Å**: [ ] –ù–µ –Ω–∞—á–∞—Ç–æ

---

## –§–∞–∑–∞ 7: –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

### 7.1 –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ TMA

- Progress bar –¥–ª—è —Ü–µ–ª–µ–π/—ç—Ç–∞–ø–æ–≤
- –ì—Ä–∞—Ñ–∏–∫ XP –ø–æ –¥–Ω—è–º (Chart.js/Recharts)
- Heatmap –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–∫–∞–∫ –Ω–∞ GitHub)

### 7.2 –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è (Achievements)

–ù–æ–≤–∞—è –º–æ–¥–µ–ª—å `Achievement`:
```python
class Achievement(Model):
    id = IntField(pk=True)
    code = CharField(max_length=50, unique=True)
    title = CharField(max_length=100)
    description = TextField()
    icon = CharField(max_length=10)  # emoji
    xp_reward = IntField(default=0)
```

–ü—Ä–∏–º–µ—Ä—ã –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π:
- "üéØ –ü–µ—Ä–≤—ã–π —à–∞–≥" ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω 1 —à–∞–≥
- "üî• –ù–µ–¥–µ–ª—è –≤ –¥–µ–ª–µ" ‚Äî 7 –¥–Ω–µ–π streak
- "üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫" ‚Äî 5 stuck flow –ø—Ä–æ–π–¥–µ–Ω–æ

### 7.3 –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ –º–∏–Ω–∏-–≤–æ–ø—Ä–æ—Å—ã:
1. –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ –¥–µ–Ω—å —Ä–µ–∞–ª—å–Ω–æ –µ—Å—Ç—å?
2. –ï—Å—Ç—å –¥–µ–¥–ª–∞–π–Ω?
3. –£—Ä–æ–≤–µ–Ω—å –æ–ø—ã—Ç–∞?
4. –ö–∞–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã –µ—Å—Ç—å?

AI –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–∞ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º.

---

## Roadmap —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –§–∞–∑–∞ | –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|------|--------|-----------|--------|
| 5.1 | –ñ–µ—Å—Ç–∫–∏–π —Ç–æ–Ω –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö | üî•üî•üî• | [x] |
| 5.2 | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ç–∞–ª–µ–π —Ü–µ–ª–∏ | üî•üî• | [x] |
| 5.3 | –®–∞–≥–∏ –¥–Ω—è + –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ | üî•üî• | [ ] |
| 5.4 | –ë–∞–≥ "–ò–∑–º–µ–Ω–∏—Ç—å" | üî¥ | [x] |
| 6.1 | –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Claude | üî•üî• | [ ] |
| 6.2 | –í–∞—Ä–∏–∞–Ω—Ç—ã –º–∏–∫—Ä–æ–¥–µ–π—Å—Ç–≤–∏–π | üî• | [ ] |
| 7.1 | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ | üî• | [ ] |
| 7.2 | –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è | üî• | [ ] |
| 7.3 | –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ | üî• | [ ] |

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–†–∞–∑–¥–µ–ª—å–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏** ‚Äî –±—ç–∫–µ–Ω–¥ –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–ø–æ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—ã Railway
2. **Vercel –¥–ª—è Next.js** ‚Äî –ª—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞, zero-config –¥–µ–ø–ª–æ–π
3. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥** ‚Äî —Å–Ω–∞—á–∞–ª–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π API, –ø–æ—Ç–æ–º —Ä–∞—Å—à–∏—Ä—è–µ–º
4. **–ñ–µ—Å—Ç–∫–∏–π —Ç–æ–Ω –ø–µ—Ä–≤—ã–º** ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π impact –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º effort
